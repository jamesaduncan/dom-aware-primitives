<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>POST Method Type Testing</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .target {
            min-height: 50px;
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
            border: 2px dashed #ccc;
        }
        button {
            margin: 5px;
            padding: 8px 16px;
            cursor: pointer;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
        pre {
            background: #f0f0f0;
            padding: 10px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>POST Method Type Testing</h1>
    
    <div class="test-section">
        <h2>Test 1: String POST</h2>
        <button onclick="testStringPost()">POST String</button>
        <div id="string-target" class="target">Target for string POST</div>
        <pre id="string-result"></pre>
    </div>

    <div class="test-section">
        <h2>Test 2: HTMLElement POST</h2>
        <button onclick="testElementPost()">POST HTMLElement</button>
        <div id="element-target" class="target">Target for element POST</div>
        <pre id="element-result"></pre>
    </div>

    <div class="test-section">
        <h2>Test 3: DocumentFragment POST</h2>
        <button onclick="testFragmentPost()">POST DocumentFragment</button>
        <div id="fragment-target" class="target">Target for fragment POST</div>
        <pre id="fragment-result"></pre>
    </div>

    <div class="test-section">
        <h2>Test 4: Invalid Type POST</h2>
        <button onclick="testInvalidPost()">POST Invalid Type</button>
        <div id="invalid-target" class="target">Target for invalid POST</div>
        <pre id="invalid-result"></pre>
    </div>

    <div class="test-section">
        <h2>Test 5: Complex HTMLElement POST</h2>
        <button onclick="testComplexElementPost()">POST Complex Element</button>
        <div id="complex-target" class="target">Target for complex element POST</div>
        <pre id="complex-result"></pre>
    </div>

    <script type="module">
        import './index.mjs';
        
        // Make functions global for onclick
        window.testStringPost = async function() {
            const target = document.getElementById('string-target');
            const result = document.getElementById('string-result');
            
            try {
                const htmlString = '<p class="posted">Posted via string at ' + new Date().toLocaleTimeString() + '</p>';
                await target.POST(htmlString);
                result.innerHTML = '<span class="success">✓ Success: Posted string content</span>';
            } catch (error) {
                result.innerHTML = '<span class="error">✗ Error: ' + error.message + '</span>';
            }
        };

        window.testElementPost = async function() {
            const target = document.getElementById('element-target');
            const result = document.getElementById('element-result');
            
            try {
                const newDiv = document.createElement('div');
                newDiv.className = 'posted-element';
                newDiv.style.color = 'blue';
                newDiv.textContent = 'Posted HTMLElement at ' + new Date().toLocaleTimeString();
                
                await target.POST(newDiv);
                result.innerHTML = '<span class="success">✓ Success: Posted HTMLElement</span>';
            } catch (error) {
                result.innerHTML = '<span class="error">✗ Error: ' + error.message + '</span>';
            }
        };

        window.testFragmentPost = async function() {
            const target = document.getElementById('fragment-target');
            const result = document.getElementById('fragment-result');
            
            try {
                const fragment = document.createDocumentFragment();
                
                const header = document.createElement('h4');
                header.textContent = 'Fragment Header';
                fragment.appendChild(header);
                
                const para = document.createElement('p');
                para.textContent = 'Fragment paragraph at ' + new Date().toLocaleTimeString();
                fragment.appendChild(para);
                
                const span = document.createElement('span');
                span.style.fontStyle = 'italic';
                span.textContent = ' (posted as DocumentFragment)';
                fragment.appendChild(span);
                
                await target.POST(fragment);
                result.innerHTML = '<span class="success">✓ Success: Posted DocumentFragment with multiple nodes</span>';
            } catch (error) {
                result.innerHTML = '<span class="error">✗ Error: ' + error.message + '</span>';
            }
        };

        window.testInvalidPost = async function() {
            const target = document.getElementById('invalid-target');
            const result = document.getElementById('invalid-result');
            
            try {
                // Try to POST a number (invalid type)
                await target.POST(12345);
                result.innerHTML = '<span class="error">✗ Should have thrown an error!</span>';
            } catch (error) {
                result.innerHTML = '<span class="success">✓ Correctly rejected invalid type: ' + error.message + '</span>';
            }
        };

        window.testComplexElementPost = async function() {
            const target = document.getElementById('complex-target');
            const result = document.getElementById('complex-result');
            
            try {
                const article = document.createElement('article');
                article.className = 'complex-post';
                
                const title = document.createElement('h3');
                title.textContent = 'Complex Element Post';
                article.appendChild(title);
                
                const content = document.createElement('div');
                content.innerHTML = `
                    <p>This is a <strong>complex</strong> element with:</p>
                    <ul>
                        <li>Nested HTML</li>
                        <li>Multiple levels</li>
                        <li>Various tags</li>
                    </ul>
                    <time>${new Date().toISOString()}</time>
                `;
                article.appendChild(content);
                
                await target.POST(article);
                result.innerHTML = '<span class="success">✓ Success: Posted complex nested HTMLElement</span>';
            } catch (error) {
                result.innerHTML = '<span class="error">✗ Error: ' + error.message + '</span>';
            }
        };

        // Listen for DAS events
        document.addEventListener('DASAvailable', () => {
            console.log('DOM-aware server detected - POST operations will make HTTP requests');
        });
        
        document.addEventListener('DASUnavailable', () => {
            console.log('No DOM-aware server - POST operations will fire DASUnavailable events');
        });
        
        // Listen for operation events
        document.addEventListener('DASOk', (event) => {
            console.log('POST operation succeeded:', event.detail);
        });
        
        document.addEventListener('DASError', (event) => {
            console.log('POST operation failed:', event.detail);
        });
    </script>
</body>
</html>